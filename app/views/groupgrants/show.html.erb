<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>

<!-- Facebook SDK -->
<div id="fb-root"></div>

<script>
  window.fbAsyncInit = function()
  {
    FB.init(
    {
      appId  : '603004516422329',
      status : true,
      xfbml  : true
    });
  };

  (function(d, s, id)
  {
    var js, fjs = d.getElementsByTagName(s)[0];

    if (d.getElementById(id)) {return;}

    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/all.js";
    fjs.parentNode.insertBefore(js, fjs);
  }

  (document, 'script', 'facebook-jssdk'));
</script>
 
<div class="text-center gg_title">
  <!-- gG Title -->
  <h1><strong><%= @groupgrant.name %><strong><br/><small><%= @groupgrant.charity.name %></small></h1>
  <% if user_signed_in? &&  current_user.id == @groupgrant.owner_id %>
    <%= link_to 'Edit groupGrant', edit_groupgrant_path(@groupgrant), class: "btn btn-primary btn-md",  style:"float:right"%>
  <% end %>
</div>

<div class="row">
	<div class = "col-md-7">
    <!-- gG Description -->
    <p class="lead">
      <%= @groupgrant.description %>
    </p>
	</div>
  <!-- gG Info -->
	<div class= "col-md-5">
    <div class= "well well-lg">
      <%= image_tag @groupgrant.groupgrant_pic.url(:small), class: "gg_image", style:":block;" %>
			<!-- gG Progress-->
      <div class="progress_bar">
          <input type="text" value="75" class="dial" readOnly="true">
        <div class="gg_raised">
          <%= number_to_currency(@groupgrant.goal_status, :precision => 0, :delimiter => ',') %> Raised 
        </div>
        <div class="gg_goal">
          <%= number_to_currency(@groupgrant.goal_amount, :precision => 0, :delimiter => ',') %> Goal
        </div>
      </div>
        <strong>
           <%= distance_of_time_in_words(Time.now, @groupgrant.goal_date)  %> left
        </strong>
      <div>
        <!-- Button trigger modal -->
        <a button class="btn btn-primary btn-lg" data-toggle="modal" data-target=".payment-form-modal-md">Donate</button></a> 
        
        <div class="modal fade payment-form-modal-md" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">Your donation will make a difference!</h4>
              </div>

              <div class="modal-body">
                <form action="/groupgrants/submit_payment" method="POST" id="payment-form">
                  <span class="payment-errors"></span>                
                  <div class="col-md-5">
                    <div class="form-group">
                      <!-- used to populate amount field -->
                      <script type="text/javascript">
                        function setText(target) 
                        {
                          var txt  = document.getElementById(target);
                          var temp = txt.value;
                          var tf   = document.getElementById("textField");
                          tf.value = temp;
                        }   
                      </script>

                      <label>
                        <span>Donation Ammount</span>
                      </label>
                      <br>
                      <div class="form-row">
                        <div class="col-md-5" style="padding-left: 0px;">                            
                          <input type="radio" name="amount" value="10" onchange="setText('10')">&nbsp; $10<br>
                          <input type="radio" name="amount" value="50" onchange="setText('50')">&nbsp; $50
                        </div>

                        <div>
                          <input type="radio" name="amount" value="100" onchange="setText('100')">&nbsp; $100<br>
                          <input type="radio" name="amount" value="500" onchange="setText('500')">&nbsp; $500
                        </div>                         
                      </div>

                      <label>
                        <br>Custom Amount
                        <div class="input-group col-md-11" style="padding-left: 0px;">
                          <span class="input-group-addon">$</span>
                          <input type="text" class="form-control" id="textField" data-stripe="amount" id="amount" name="amount">
                          <span class="input-group-addon">.00</span>
                        </div>                         
                      </label>
                    </div>

                    <table class="activity-desc">
                      <tbody><tr>                          
                        <td>
                          <div style="clear:both; vertical-align: middle;">
                            <%= image_tag @groupgrant.groupgrant_pic.url(:small), class:"col-md-5" %>
                            <p>Donating To:
                              <br><b><%= @groupgrant.name %></b>
                            </p>       
                          </div>                           
                        </td>
                      </tr></tbody>
                    </table>
                  </div>

                  <div class="col-md-7" style="height: 215px;">
                    <div class="form-group">
                      <label>
                        <span>Card Number</span>
                        <br>
                        <input type="text" size="20" class="form-control" data-stripe="number"/>
                      </label>
                    </div> 

                    <div class="form-group">
                      <label>Expiration Date</label>
                      <div class="row">
                        <div class="col-xs-4">
                          <select class="form-control" name="exp-month" data-stripe="exp-month" style="width: 88px" placeholder="MM">
                            <option><b>Month</b></option>
                            <option value="1">01 - Jan</option>
                            <option value="2">02 - Feb</option>
                            <option value="3">03 - Mar</option>
                            <option value="4">04 - Apr</option>
                            <option value="5">05 - May</option>
                            <option value="6">06 - Jun</option>
                            <option value="7">07 - Jul</option>
                            <option value="8">08 - Aug</option>
                            <option value="9">09 - Sep</option>
                            <option value="10">10 - Oct</option>
                            <option value="11">11 - Nov</option>
                            <option value="12">12 - Dec</option>
                          </select>                           
                        </div>

                        <div class="col-xs-4 no_padding">
                          <select class="form-control" name="exp-year" data-stripe="exp-year" style="width: 88px" placeholder="YYYY">
                            <option>Year</option>
                            <option value="2014">2014</option>
                            <option value="2015">2015</option>
                            <option value="2016">2016</option>
                            <option value="2017">2017</option>
                            <option value="2018">2018</option>
                            <option value="2019">2019</option>
                            <option value="2020">2020</option>
                            <option value="2021">2021</option>
                            <option value="2022">2022</option>
                            <option value="2023">2023</option>
                            <option value="2024">2024</option>
                          </select>                            
                        </div>

                        <div class="col-xs-4">
                          <input type="text" class="form-control" size="3" data-stripe="cvc" placeholder="CVC" style="width: 55px"/>
                        </div>
                      </div>
                    </div> 
                  </div> 
                </form>
              </div><!-- /.modal-body -->             

              <div class="modal-footer">
                 <div class="form-group" style="float: left; font-size: small; padding-left: 15px;">                      
                  <p>
                    <span class="glyphicon glyphicon-lock"></span>
                    Secured by
                    <a href="http://www.stripe.com">
                      <b>Stripe</b> 
                     </a>
                  </p>
                </div>
                  
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary">Submit</button>                       
              </div><!-- /.modal-footer -->             
            </div><!-- /.modal-content -->
          </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->
      </div>
    </div>

    <div class = "social-media-icons automargin">
    <!-- Social Media -->
      <table>
        <tr>
           <td>
              <!-- Share a Tweet-->
              <script>
                 !function(d,s,id)
                 {
                   var js,fjs=d.getElementsByTagName(s)[0];

                   if(!d.getElementById(id))
                   {
                     js=d.createElement(s);
                     js.id=id;
                     js.src="https://platform.twitter.com/widgets.js";
                     fjs.parentNode.insertBefore(js,fjs);
                   }
                 }
                 (document,"script","twitter-wjs");

                 $(document).ready(function()
                 {
                   var href = location.pathname;
                   var tweet = "<a href=\'http://www.groupGrant.com" + href;
                       tweet = tweet + "\' class=\'twitter-share-button\' data-lang=\'en\' data-count=\'none\'>Tweet</a>";
                   var share = "<div class=\'fb-share-button\' data-href=\'http://www.groupGrant.com" + href + "\'data-width=\'100\' data-type=\'button\'></div>";

                   $("#tweets").html(tweet);
                   $("#sharePage").html(share);
                 });
              </script>
              <!-- Show Tweet Button -->
              <div id="tweets"></div>              
           </td>
        </tr>
        <tr>
           <td>
              <!-- Show Facebook button -->
              <div id="sharePage"></div>
           </td>
        </tr>
      </table>
    </div>
  </div>
</div>

<div class=>
  <div class="col-md-7">
  <!-- Photos/Videos -->
  </div>

  <div class = "col-md-5">
    <!-- Partnerships -->
    <h3>Sponsors</h3>
    <h4><%= @groupgrant.charity.name %></h4>
    <div style="clear:both;">
      <%= image_tag @groupgrant.charity.charity_pic.url(:small), class:"col-md-2" %>
      <%= @groupgrant.charity.description %>
    </div>
    <br />

    <div id="sponsors">
      <% if user_signed_in? && current_user.rolable_type == "Business" && @groupgrant.partner_id == 0 %>
      <% r = Request.where(groupgrant_id: @groupgrant.id)
        #check if this is the user that sent it
        if (r[0] != nil)
          r = Request.find(r)
          m = Message.where(request_id: r.id)
          m = Message.find(m)
      
          if (m.user_sent_id == current_user.id) %>
            <div class="btn btn-primary" id="cancel" data-groupgrant=<%=@groupgrant.id %> >
               Request Pending. Cancel? 
            </div>
          <% end %>
          <% else %>
            <div id="request" class="btn btn-primary" data-groupgrant=<%=@groupgrant.id %> >
              Connect with Charity 
            </div>
        <% end %>
      <% end %>
    </div>
  </div> 
</div>

<%= javascript_include_tag("https://js.stripe.com/v2/") %>
<%= javascript_include_tag("stripe.js") %>
<%= javascript_include_tag("jquery.knob.js") %>
